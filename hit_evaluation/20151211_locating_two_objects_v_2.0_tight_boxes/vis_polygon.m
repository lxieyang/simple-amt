% visualize annotations
% After running this function, all the visualizations of the annotations
% will be under the folder called "./vis"

function [] = vis_polygon(assignment_id, img_url, im_name, coord_first, coord_second, ...
                          sample_coord_first, sample_coord_second, sample_entry_url)

% set paths
% im_dir   = './images/';
% anno_dir = './anno/';
vis_dir  = './vis/';

 if ~exist(vis_dir,'dir')
     mkdir(vis_dir);
 end

fprintf('visualizing annotation ... \n');

for j = 1 : numel(assignment_id)
    for i = 1 : numel(img_url{j})

        % vis_file  = [vis_dir im_name '_' num2str(j) '_' num2str(i) '_vis.png'];
        vis_file = [vis_dir im_name '_' assignment_id{j} '_' num2str(i) '_vis.png'];

        % read image and load annotation
        im = imread(char(img_url{j}{i}));
        % ld = load(anno_file);
        figure;

        % display image
        clf; imshow(im); hold on;

        % remove matlab figure border
        set_up_gcf(size(im,1), size(im,2));

        % display boxes
        poly1 = coord_first{j}{i};
        hpoly1 = line( ...
            'Parent', gca, ...
            'XData', [poly1(:,1);poly1(1,1)], ...
            'YData', [poly1(:,2);poly1(1,2)], ...
            'Visible', 'on', ...
            'Clipping', 'off', ...
            'Color', 'r', ...
            'LineStyle', '-', ...
            'LineWidth', 3, ...
            'Marker', 's', ...
            'MarkerEdgeColor', 'r', ...
            'MarkerFaceColor', 'r' ...
            );
        
        poly2 = coord_second{j}{i};
        hpoly2 = line( ...
            'Parent', gca, ...
            'XData', [poly2(:,1);poly2(1,1)], ...
            'YData', [poly2(:,2);poly2(1,2)], ...
            'Visible', 'on', ...
            'Clipping', 'off', ...
            'Color', 'g', ...
            'LineStyle', '-', ...
            'LineWidth', 3, ...
            'Marker', 's', ...
            'MarkerEdgeColor', 'r', ...
            'MarkerFaceColor', 'r' ...
            );
        
        for k = 1 : numel(sample_entry_url)
            if strcmp(char(sample_entry_url{k}), char(img_url{j}{i}))
                
                % display sample boxes if available
                Spoly1 = sample_coord_first{k};
                Shpoly1 = line( ...
                    'Parent', gca, ...
                    'XData', [Spoly1(:,1);Spoly1(1,1)], ...
                    'YData', [Spoly1(:,2);Spoly1(1,2)], ...
                    'Visible', 'on', ...
                    'Clipping', 'off', ...
                    'Color', 'r', ...
                    'LineStyle', '--', ...
                    'LineWidth', 3, ...
                    'Marker', 's', ...
                    'MarkerEdgeColor', 'r', ...
                    'MarkerFaceColor', 'r' ...
                    );

                Spoly2 = sample_coord_second{k};
                Shpoly2 = line( ...
                    'Parent', gca, ...
                    'XData', [Spoly2(:,1);Spoly2(1,1)], ...
                    'YData', [Spoly2(:,2);Spoly2(1,2)], ...
                    'Visible', 'on', ...
                    'Clipping', 'off', ...
                    'Color', 'g', ...
                    'LineStyle', '--', ...
                    'LineWidth', 3, ...
                    'Marker', 's', ...
                    'MarkerEdgeColor', 'r', ...
                    'MarkerFaceColor', 'r' ...
                    );
                
                break;
            end
        end

        % save file
        print(gcf,'-dpng',vis_file,'-r0');  % -r0: output with the same size
        
        % pause if you want to take a closer look
        % pause(1);
        
        close;
    end
end
%close;

end

